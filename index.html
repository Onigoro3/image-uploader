<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>画像アップローダー (検索機能付き)</title>
    <style>
        /* (スタイル部分は変更なし) */
        body { font-family: sans-serif; line-height: 1.6; padding: 1em 2em; }
        hr { margin: 2em 0; }
        input[type="text"], input[type="search"] { padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 5px 10px; cursor: pointer; }
        #upload-section { background: #f9f9f9; padding: 15px; border-radius: 8px; display: flex; gap: 20px; }
        #upload-section > div { flex: 1; }
        #uploadStatus { font-weight: bold; }
        #csvDownloader { display: inline-block; padding: 8px 12px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; }
        #gallery-section { display: flex; gap: 20px; }
        #category-container, #folder-container { width: 200px; border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fafafa; }
        #search-section { margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px; }
        #searchInput { width: 300px; padding: 8px; }
        #image-gallery-container { flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 10px; padding-top: 10px; }
        .category, .folder-item span { cursor: pointer; }
        .category, .folder-item { padding: 8px; border: 1px solid #ccc; border-radius: 5px; background-color: #f4f4f4; font-weight: bold; margin-bottom: 5px; }
        .category.active, .folder-item.active { background-color: #007bff; color: white; border-color: #007bff; }
        .folder-item { display: flex; justify-content: space-between; align-items: center; }
        .folder-item span { flex-grow: 1; }
        .delete-btn { background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; cursor: pointer; font-weight: bold; line-height: 20px; text-align: center; flex-shrink: 0; margin-left: 5px; }
        .delete-btn:hover { background: #c82333; }
        .gallery-image { width: 100%; height: 130px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="upload-section">
        {/* (アップロード部分は変更なし) */}
        <div><h2>画像をアップロード</h2><p><label for="categoryNameInput"><b>1. 保存先カテゴリ名:</b></label><br><input type="text" id="categoryNameInput" value="default_category" placeholder="カテゴリ名"></p><p><label for="folderNameInput"><b>2. 保存先フォルダ名:</b></label><br><input type="text" id="folderNameInput" value="default_folder" placeholder="フォルダ名"></p></div>
        <div><p><b>3. ファイルを選択</b></p><input type="file" id="imageInput" accept="image/*" multiple><button id="uploadButton">アップロード</button><p id="uploadStatus"></p></div>
    </div>
    <hr>
    <h3>履歴のダウンロード</h3><p>現在選択中の**フォルダ**のCSVをダウンロードします。</p><a href="#" id="csvDownloader" style="visibility: hidden;">CSVダウンロード</a><p id="csv-status-text">(フォルダを選択するとボタンが有効になります)</p>
    <hr>
    <h3>カテゴリ・フォルダ別 ギャラリー</h3><p>カテゴリ → フォルダ → (検索) の順で画像を表示します。</p>

    <div id="gallery-section">
        <div id="category-container"><h4>カテゴリ</h4><p id="category-loading-status">読み込み中...</p></div>
        <div id="folder-container"><h4>フォルダ</h4><p id="folder-loading-status"></p></div>
    </div>

    {/* ▼▼▼ 修正点: コメントの書き方を修正 ▼▼▼ */}
    <div id="search-section" style="display: none;">
         <label for="searchInput"><b>画像ファイル名検索:</b></label>
         <input type="search" id="searchInput" placeholder="ファイル名の一部を入力...">
    </div>
    {/* ▲▲▲ 修正点ここまで ▲▲▲ */}

    <div id="image-gallery-container"></div>

    <script>
        // --- HTML要素を取得 ---
        const fileInput = document.getElementById('imageInput');
        const categoryNameInput = document.getElementById('categoryNameInput');
        const folderNameInput = document.getElementById('folderNameInput');
        const uploadButton = document.getElementById('uploadButton');
        const statusP = document.getElementById('uploadStatus');
        const categoryContainer = document.getElementById('category-container');
        const folderContainer = document.getElementById('folder-container');
        const galleryContainer = document.getElementById('image-gallery-container');
        const categoryStatus = document.getElementById('category-loading-status');
        const folderStatus = document.getElementById('folder-loading-status');
        const csvButton = document.getElementById('csvDownloader');
        const csvStatus = document.getElementById('csv-status-text');
        const searchSection = document.getElementById('search-section');
        const searchInput = document.getElementById('searchInput');

        let currentSelectedFolder = null;

        // --- アップロード機能 (変更なし) ---
        uploadButton.addEventListener('click', async () => { /* ... */ }); // 省略 (前のコードと同じ)

        // --- ギャラリー機能 ---
        document.addEventListener('DOMContentLoaded', () => { loadCategories(); });

        // (B) カテゴリ読み込み (変更なし)
        async function loadCategories() { /* ... */ } // 省略 (前のコードと同じ)

        // (C) フォルダ読み込み (変更なし)
        async function loadFolders(categoryName) { /* ... */ } // 省略 (前のコードと同じ)

        // (D) 画像読み込み (変更なし)
        async function loadImages(folderName) {
            currentSelectedFolder = folderName;
            searchInput.value = '';
            searchSection.style.display = 'block';
            await displayImages(folderName, ''); // 最初は全画像を表示
        }

        // (NEW) 検索入力イベントリスナー (変更なし)
        let searchTimeout;
        searchInput.addEventListener('input', () => { /* ... */ }); // 省略 (前のコードと同じ)

        // (NEW) 画像取得・表示関数 (変更なし)
        async function displayImages(folderName, searchTerm) { /* ... */ } // 省略 (前のコードと同じ)

        // (E) フォルダ削除関数 (変更なし)
        async function deleteFolder(folderName) { /* ... */ } // 省略 (前のコードと同じ)

        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
        // ★ 注意：上記の省略した JavaScript 関数の中身は、    ★
        // ★ 前回の回答（10:23）からコピーして貼り付けてください ★
        // ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★
    </script>

</body>
</html>