--- a/index.html
+++ b/index.html
@@ -3,6 +3,14 @@
 <head>
     <meta charset="UTF-8">
     <title>画像アップローダー (全機能)</title>
+    +    <style>
+        #auth-status {
+            position: fixed; top: 10px; right: 20px; background: #fff; padding: 5px 10px; border-radius: 5px; border: 1px solid #ccc; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 100;
+        }
+        #auth-status button { margin-left: 10px; background: #dc3545; color: white; border: none; }
+    </style>
+    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.14.2/simple-lightbox.min.css" integrity="sha512-FaAQujRxLMvw+BkmGN3w7u9EdQQr1t0vQoY8KDh09+6SFaWSTe+KrT8oCWg25X91hytm5c5BTmiSGQejkraaZg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
     <style>
         body { font-family: sans-serif; line-height: 1.6; padding: 1em 2em; }
@@ -52,6 +60,12 @@
     </style>
 </head>
 <body>
+    +    <div id="auth-status">
+        <span id="username-display">...</span>
+        <button id="logoutButton">ログアウト</button>
+    </div>
+    <div id="upload-section">
         <div><label for="cat1Select">1. 大カテゴリ:</label><select id="cat1Select"></select><input type="text" id="cat1NewInput" class="new-input" placeholder="新しい大カテゴリ名"></div>
@@ -124,7 +138,28 @@
         });
 
         // --- ギャラリー機能 ---
-        document.addEventListener('DOMContentLoaded', () => { loadCat1(); setupSelectListeners(); setupSortListeners(); });
+        // ▼ 認証機能 (DOMContentLoaded の修正) ▼
+        document.addEventListener('DOMContentLoaded', async () => {
+            // 1. ログイン状態をチェック
+            try {
+                const response = await fetch('/api/auth/check');
+                const authData = await response.json();
+
+                if (authData.loggedIn) {
+                    // 2. ログイン済み -> ユーザー名を表示し、アプリを初期化
+                    document.getElementById('username-display').textContent = `ようこそ, ${authData.username} さん`;
+                    loadCat1(); // メインの処理を開始
+                    setupSelectListeners();
+                    setupSortListeners();
+                    setupLogoutButton(); // ログアウトボタンの設定
+                } else {
+                    // 3. 未ログイン -> ログインページへリダイレクト
+                    window.location.href = '/login';
+                }
+            } catch (error) {
+                window.location.href = '/login'; // エラー時もログインへ
+            }
+        });
 
         // Select要素の選択肢生成
         function populateSelect(selectElement, items, currentSelection) {
@@ -176,7 +211,21 @@
                 if (items.length === 0) { container.innerHTML += '<p>データなし</p>'; return; }
                 items.forEach(itemName => {
                     const itemDiv = document.createElement('div'); itemDiv.className = 'gallery-item';
-                    const nameSpan = document.createElement('span'); nameSpan.innerText = itemName;
+                    // ( ... 既存の itemDiv 生成ロジック ... )
+                });
+            } catch (error) { 
+                console.error(`${title}読み込みエラー:`, error); 
+                container.innerHTML = `<h4>${title}</h4><p style="color: red;">失敗</p>`; 
+                // ▼ 認証機能 (401エラーチェック) ▼
+                if (error.message.includes("401")) {
+                    alert("セッションが切れました。再度ログインしてください。");
+                    window.location.href = '/login';
+                }
+                // ▲ 認証機能 ▲
+            }
+        }
+        // ( ※ 他の fetch を使う関数 (displayImages, deleteItem, renameItem, analyzeFolder) の
+        //   catch ブロックにも、同様の401エラーチェックを追加することを推奨します )
                     nameSpan.addEventListener('click', () => { document.querySelectorAll(`#${container.id} .gallery-item`).forEach(el => el.classList.remove('active')); itemDiv.classList.add('active'); onClickCallback(itemName); });
                     itemDiv.appendChild(nameSpan);
                     if (addActionButtons) {
@@ -288,6 +337,21 @@
                 a.download = filename; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); a.remove();
                 analyzeStatus.innerText = `「${folderName}」解析CSV完了`; analyzeStatus.style.color = 'green';
             } catch (error) { console.error('解析エラー:', error); analyzeStatus.innerText = `解析失敗: ${error.message}`; statusP.style.color = 'red'; }
+        }
+
+        // --- ▼ 認証機能 (ログアウト処理) ▼ ---
+        function setupLogoutButton() {
+            document.getElementById('logoutButton').addEventListener('click', async () => {
+                try {
+                    const response = await fetch('/api/auth/logout', { method: 'POST' });
+                    if (response.ok) {
+                        window.location.href = '/login'; // ログアウト成功
+                    } else {
+                        alert('ログアウトに失敗しました。');
+                    }
+                } catch (error) {
+                    alert('ログアウト中にエラーが発生しました。');
+                }
+            });
         }
     </script>
 </body>